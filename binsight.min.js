(function(){if(!"performance" in window||!"timing" in window.performance){return}var k=INS_APM&&"info" in INS_APM&&"appId" in INS_APM.info?INS_APM.info.appId:"";if(!k&&k==""){return}var c={appId:"",postUrl:"http://tag.xinshangmeng.com/v2",addListener:function(o,n,m){if(o.addEventListener){o.addEventListener(n,m,false)}else{if(o.attachEvent){o.attachEvent("on"+n,m)}}},str2Byte:function(p){if(!p){return 0}var m=p.length,n=0;for(var o=0;o<m;o++){p.charCodeAt(o)>255?n+=2:n+=1}return n},clearUrlParam:function(n){if(!n){return null}var o=n.split("?");var p=o[1];if(p&&p.indexOf("method")==0){var m=o[0]+"/"+p.split("&")[0].split("=")[1];return m.substring(m.length-255)}else{return o[0].substring(o[0].length-255)}},post_data:function(m,o){var n=function(){d.corsSend(m,o)};if(window.setImmediate){window.setImmediate(n)}else{if(window.msSetImmediate){window.msSetImmediate(n)}else{if(window.webkitSetImmediate){window.webkitSetImmediate(n)}else{if(window.mozSetImmediate){window.mozSetImmediate(n)}else{setTimeout(n,10)}}}}}};var d={is_complete:true,corsSend:function(n,q){try{var p=new XMLHttpRequest();if(!"withCredentials" in p){p=XDomainRequest()}if(!p){return}p.open("POST",n,true);if("setRequestHeader" in p){p.setRequestHeader("Content-type","application/x-www-form-urlencoded")}p.send(m(q));p.onload=function(){if("console" in window){console.log(p.responseText)}}}catch(o){if("console" in window){console.log(o)}}function m(w){var r=[];var t=null;for(t in w){if(w.hasOwnProperty(t)){var u=Object.prototype.toString.call(w[t]);var s="";if(u==="[object Array]"||u==="[object Object]"){s=(w[t]===undefined||w[t]===null?"":encodeURIComponent(JSON.stringify(w[t])))}else{s=(w[t]===undefined||w[t]===null?"":encodeURIComponent(w[t]))}r.push(t+"="+s)}}if(r.length>0){return r.join("&")}return null}}};var e=a();var l=decodeURI(window.location.search);var j=window.location.pathname+(l&&l.indexOf("?method=")>-1?"/"+l.substring(8,(l.indexOf("&")>-1?l.indexOf("&"):l.length)):"");var i={domain:document.domain,pageUrl:j.substring(j.length-255)};f();function f(){c.addListener(document,"readystatechange",function(){if(i.pageUrl.indexOf("/apm/collector")>-1){return}if(document.readyState=="complete"){b()}});h();g()}function b(){var o={};var n=[];if("performance" in window&&"timing" in window.performance){var t=window.performance.timing;o.start=t.navigationStart;o.total=(t.loadEventEnd==0?t.domComplete:t.loadEventEnd)-t.navigationStart;o.redirect=t.redirectEnd-t.redirectStart;o.cache=t.domainLookupStart-t.fetchStart;o.dns=t.domainLookupEnd-t.domainLookupStart;o.connect=t.connectEnd-t.connectStart;o.request=t.responseStart-(t.secureConnectionStart?t.secureConnectionStart:t.requestStart);o.response=t.responseEnd==0?0:(t.responseEnd-t.responseStart);o.domParse=t.domInteractive-t.domLoading;o.domContent=t.domContentLoadedEventEnd-t.domContentLoadedEventStart;o.domDraw=t.domComplete-t.domContentLoadedEventEnd;o.loadEvent=t.loadEventEnd-t.loadEventStart;var m=window.performance.navigation;o.redirectCount=m.redirectCount;o.loadType=m.type;if("getEntries" in window.performance){var p=window.performance.getEntriesByType("resource");if(p.length>1){p.sort(function(v,u){return v.duration>u.duration?-1:1})}p=p.slice(0,10);for(var s=0;s<p.length;s++){if(p[s].name.indexOf(c.postUrl)>-1){continue}var r=c.clearUrlParam(p[s].name);r=r.indexOf("http")==0?r.substring(r.indexOf("//")+2):r;n.push({name:r,indicatorType:p[s].initiatorType,total:Math.round(p[s].duration)})}}}if(o&&o.start){var q=c.postUrl+"/ppf.gif";c.post_data(q,{appId:k,clientInfo:e,page:i,perf:o,entries:n,clientTime:(new Date()).getTime()})}}function a(){var o=window.navigator.userAgent;var q=n(o);var p=m(o);return{scrWidth:window.screen.width,scrHeight:window.screen.height,browser_name:q.browser_name,browser_version:q.browser_version,os_name:p.os_name,os_version:p.os_version};function n(r){var t;if((t=r.match(/rv:([\d.]+)\) like gecko/i))){return{browser_name:"MSIE",browser_version:t[1]}}else{var u=r.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\d+)/i)||[];if(u.length>=3){return{browser_name:u[1],browser_version:u[2]}}else{return{browser_name:"Other",browser_version:""}}}}function m(s){var r=navigator.platform;var u="";var t="";if(r=="Win32"||r=="Win64"||r=="Windows"){u="Windows";if(s.indexOf("Windows NT 5.1")>-1||s.indexOf("Windows XP")>-1){t="XP"}else{if(s.indexOf("Windows NT 5.2")>-1||s.indexOf("Windows 2003")>-1){t="2003"}else{if(s.indexOf("Windows NT 6.0")>-1||s.indexOf("Windows Vista")>-1){t="Vista"}else{if(s.indexOf("Windows NT 6.1")>-1||s.indexOf("Windows 7")>-1){t="7"}else{if(s.indexOf("Windows NT 6.2")>-1||s.indexOf("Windows 8")>-1){t="8"}else{if(s.indexOf("Windows NT 6.3")>-1||s.indexOf("Windows 8.1")>-1){t="8.1"}else{if(s.indexOf("Windows NT 10")>-1||s.indexOf("Windows 10")>-1){t="10"}else{t="Other"}}}}}}}}else{if(s.indexOf("Mac")>-1){u="Mac Os"}else{if(r.indexOf("X11")>-1){u="Unix"}else{if(r.indexOf("Linux")>-1){u="Linux"}else{u="Other"}}}}return{os_name:u,os_version:t}}}function h(){var m=window.XMLHttpRequest;window.XMLHttpRequest=function(o){var n=new m(o);var p=(""+Math.random()).replace(".","");n["startTime"+p]=0;n["endTime"+p]=0;n["open_url"]="";if(m.prototype.addEventListener){n.open=function(q,s,r){n["open_url"]=s;m.prototype.open.apply(this,arguments)};n.addEventListener("readystatechange",function(){if(!n["open_url"]||n["open_url"]==""||(n["open_url"]&&n["open_url"].indexOf(c.postUrl)>-1)){return false}var t=n.readyState;if(t==0){n["startTime"+p]=new Date().getTime()}if(t==1){n["startTime"+p]=n["startTime"+p]==0?new Date().getTime():n["startTime"+p]}if(t==2){n["startTime"+p]=n["startTime"+p]==0?new Date().getTime():n["startTime"+p]}if(t==3){n["startTime"+p]=n["startTime"+p]==0?new Date().getTime():n["startTime"+p]}if(t==4){n["endTime"+p]=new Date().getTime();var r=c.clearUrlParam(decodeURI(n["open_url"]));var s={respUrl:r,times:n["endTime"+p]-n["startTime"+p],statusCode:n.status,recBytes:c.str2Byte(n.responseText)};if(r&&r!=undefined&&r!=""){var q=c.postUrl+"/xhr.gif";c.post_data(q,{appId:k,clientInfo:e,page:i,xhr:s,clientTime:(new Date()).getTime()})}}},false)}return n};window.XMLHttpRequest.prototype=m.prototype}function g(){window.onerror=function(q,s,r,p){var o={};var n=p?p:JSON.stringify(q);if(typeof q=="string"&&typeof s=="string"){o.error_file=c.clearUrlParam(s);o.error_line=r;o.error_msg=n.substring(n.length-255)}else{if(typeof s=="object"&&s.ajax){s=s.ajax.url;o.error_file=c.clearUrlParam(s);o.error_line=r;o.error_msg=n.substring(n.length-255)}}if(o&&o.error_file){var m=c.postUrl+"/jse.gif";c.post_data(m,{appId:k,clientInfo:e,page:i,jserror:o,clientTime:(new Date()).getTime()})}}}})();
